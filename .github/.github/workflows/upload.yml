
# 工作流的名称，在 GitHub Actions 页面显示
name: Upload File from URL

# 触发条件：仅允许手动触发（不会在 push 或 PR 时自动运行）
on:
  workflow_dispatch:
    # 定义用户在手动运行时需要输入的参数
    inputs:
      file_url:
        description: 'File URL to download'  # 输入框提示文字
        required: true                       # 必填
        type: string                         # 输入类型为文本
      filename:
        description: 'Filename to save as'
        required: true
        type: string

# 定义一个名为 "upload" 的任务（job）
jobs:
  upload:
    # 在 Ubuntu 最新虚拟机上运行（免费、常用）
    runs-on: ubuntu-latest

    # 任务包含的步骤（steps）
    steps:
      # 第一步：检出（checkout）你的仓库代码
      - uses: actions/checkout@v4
        with:
          # 使用一个具有写权限的 token（需提前在 Secrets 中配置）
          token: ${{ secrets.GH_PAT }}

      # 第二步：从用户提供的 URL 下载文件
      - name: Download file
        run: |
          # 使用 curl 下载文件，保存为用户指定的文件名
          curl -fL -o "${{ github.event.inputs.filename }}" "${{ github.event.inputs.file_url }}"

      # 第三步：将下载的文件提交并推送到仓库
      - name: Commit and push
        run: |
          # 配置 Git 用户信息（必须，否则 commit 失败）
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          # 添加所有更改（包括新下载的文件）
          git add .
          
          # 提交更改，提交信息中包含文件名
          git commit -m "Add ${{ github.event.inputs.filename }} from URL"
          
          # 推送回当前分支
          git push
